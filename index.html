<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #f0f2f5);
            color: var(--tg-theme-text-color, #000);
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        h1 {
            color: var(--tg-theme-button-color, #40a7e3);
        }
        
        .stats {
            background: var(--tg-theme-secondary-bg-color, #fff);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 18px;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--tg-theme-button-color, #40a7e3);
        }
        
        .click-button {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ff4757, #ff0000);
            border: none;
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(255,0,0,0.3);
            margin: 30px auto;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .click-button:active {
            transform: scale(0.95);
        }
        
        .message {
            min-height: 30px;
            margin: 10px;
            font-weight: bold;
        }
        
        .success {
            color: #4caf50;
        }
        
        .error {
            color: #f44336;
        }
        
        .user-info {
            background: var(--tg-theme-secondary-bg-color, #fff);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –ö–õ–ò–ö–ï–†</h1>
        
        <div class="user-info" id="userInfo">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
        
        <div class="stats">
            <div class="stat-row">
                <span>üëÜ –ö–ª–∏–∫–∏:</span>
                <span class="stat-value" id="clicks">0</span>
            </div>
            <div class="stat-row">
                <span>‚ö° –≠–Ω–µ—Ä–≥–∏—è:</span>
                <span class="stat-value" id="energy">100/100</span>
            </div>
            <div class="stat-row">
                <span>üìä –£—Ä–æ–≤–µ–Ω—å:</span>
                <span class="stat-value" id="level">1</span>
            </div>
            <div class="stat-row">
                <span>üí™ –°–∏–ª–∞:</span>
                <span class="stat-value" id="power">2</span>
            </div>
        </div>
        
        <button class="click-button" id="clickBtn" onclick="handleClick()">
            –ö–õ–ò–ö
        </button>
        
        <div class="message" id="message"></div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ WebApp –≥–æ—Ç–æ–≤
        tg.ready();
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        const initData = tg.initDataUnsafe;
        const user = initData.user;
        
        console.log('=== –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===');
        console.log('initData:', initData);
        console.log('user:', user);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        const userInfo = document.getElementById('userInfo');
        if (user) {
            userInfo.innerHTML = `
                ‚úÖ ID: ${user.id}<br>
                –ò–º—è: ${user.first_name}<br>
                –Æ–∑–µ—Ä–Ω–µ–π–º: ${user.username || '–Ω–µ—Ç'}<br>
                Platform: ${tg.platform}
            `;
        } else {
            userInfo.innerHTML = '‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!';
            userInfo.style.color = 'red';
        }
        
        let clicks = 0;
        
        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + type;
            setTimeout(() => {
                if (msg.textContent === text) {
                    msg.textContent = '';
                    msg.className = 'message';
                }
            }, 2000);
        }
        
        function handleClick() {
            console.log('üñ±Ô∏è –ö–ª–∏–∫!');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (!user) {
                showMessage('–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                return;
            }
            
            const btn = document.getElementById('clickBtn');
            btn.style.transform = 'scale(0.9)';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç
            const data = {
                action: 'click'
                // –ù–ï –ù–£–ñ–ù–û –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å user_id - –±–æ—Ç —Å–∞–º –∑–Ω–∞–µ—Ç, –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª
            };
            
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞:', data);
            tg.sendData(JSON.stringify(data));
            
            setTimeout(() => {
                btn.style.transform = 'scale(1)';
            }, 100);
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞
        tg.onEvent('webAppData', function(event) {
            console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', event);
            
            try {
                const data = JSON.parse(event.data);
                console.log('–î–∞–Ω–Ω—ã–µ:', data);
                
                if (data.success) {
                    clicks = data.clicks;
                    document.getElementById('clicks').textContent = clicks;
                    showMessage('‚úì –ö–ª–∏–∫ –∑–∞—Å—á–∏—Ç–∞–Ω!', 'success');
                } else {
                    showMessage('–û—à–∏–±–∫–∞: ' + (data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch(e) {
                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', e);
            }
        });
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function refreshStats() {
            if (!user) return;
            
            tg.sendData(JSON.stringify({
                action: 'get_stats'
            }));
        }
        
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(refreshStats, 1000);
        
        console.log('=== –ì–û–¢–û–í–û ===');
    </script>
</body>
</html>
